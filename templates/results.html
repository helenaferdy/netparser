<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netparser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .pandas-table th {
            @apply px-6 py-3 font-medium text-slate-400 uppercase tracking-wider bg-slate-800/95 backdrop-blur-md;
            font-size: 0.85rem;
            white-space: nowrap;
            text-align: center;
            border-right: 1px solid #334155;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .pandas-table td {
            @apply px-6 py-4 text-slate-300;
            font-size: 0.8rem;
            border-right: 1px solid #334155;
            max-width: 28rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .pandas-table th:last-child,
        .pandas-table td:last-child {
            border-right: none;
        }
        .pandas-table tbody tr:nth-child(even) {
            @apply bg-slate-800/50;
        }
         .pandas-table tbody tr:hover {
            @apply bg-slate-700/50;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(0.95);
            }
        }
        .dot {
            animation: pulse 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) {
            animation-delay: -0.32s;
        }
        .dot:nth-child(2) {
            animation-delay: -0.16s;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300 h-screen flex flex-col overflow-hidden">

    <div id="loader-overlay" class="fixed inset-0 bg-slate-900 bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm transition-opacity duration-500 ease-out">
        <div class="text-center">
            <div class="flex justify-center items-center space-x-2">
                <div class="dot w-4 h-4 bg-indigo-500 rounded-full"></div>
                <div class="dot w-4 h-4 bg-indigo-500 rounded-full"></div>
                <div class="dot w-4 h-4 bg-indigo-500 rounded-full"></div>
            </div>
            <p class="mt-4 text-lg text-white">Loading...</p>
        </div>
    </div>

    <div id="main-content" class="h-full flex flex-col opacity-0 transition-opacity duration-500 ease-in">
        <header class="bg-slate-900/70 backdrop-blur-sm border-b border-slate-700 p-4 shadow-md z-20 flex justify-between items-center px-4 sm:px-6 lg:px-8 flex-shrink-0">
            <a href="{{ url_for('index') }}" title="Back to Home">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="h-10 w-auto" onerror="this.onerror=null; this.outerHTML='<div class=\'h-10 w-10 bg-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-lg\'>N</div>';">
            </a>
            {% if table_html %}
                <a href="{{ url_for('download_file', session_name=session_name, filename=main_report_name) }}"
                   class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-indigo-500 transition-colors">
                    Download Final Report (.xlsx)
                </a>
            {% endif %}
        </header>

        <div class="flex-grow overflow-hidden p-4 sm:p-6 lg:p-8 flex flex-col">
            <div x-data="{ tab: 'summary' }" class="flex-grow flex flex-col overflow-hidden">
                <div class="border-b border-slate-700 flex-shrink-0">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button @click="tab = 'summary'" :class="{ 'border-indigo-500 text-indigo-400': tab === 'summary', 'border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-500': tab !== 'summary' }"
                                class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none transition-colors">
                            Final Report
                        </button>
                        <button @click="tab = 'downloads'" :class="{ 'border-indigo-500 text-indigo-400': tab === 'downloads', 'border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-500': tab !== 'downloads' }"
                                class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none transition-colors">
                            Download Other Reports
                        </button>
                    </nav>
                </div>

                <div class="mt-6 flex-grow overflow-hidden">
                    <div x-show="tab === 'summary'" x-cloak class="h-full flex flex-col">
                        {% if table_html %}
                            <div class="overflow-auto border border-slate-700 rounded-lg flex-grow">
                                <div class="pandas-table">
                                    {{ table_html | safe }}
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center py-12 text-slate-500">
                                <p>The main summary report could not be found or read.</p>
                            </div>
                        {% endif %}
                    </div>

                    <div x-show="tab === 'downloads'" x-cloak class="h-full flex flex-col">
                        {% if other_files %}
                            <div class="border border-slate-700 rounded-lg overflow-auto flex-grow">
                                <table class="min-w-full divide-y divide-slate-700">
                                    <thead class="bg-slate-800">
                                        <tr>
                                            <th scope="col" class="w-16 px-6 py-3 text-center text-xs font-medium text-slate-400 uppercase tracking-wider">#</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">
                                                Individual Device Reports
                                            </th>
                                            <th scope="col" class="relative px-6 py-3">
                                                <span class="sr-only">Download</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-slate-800/50 divide-y divide-slate-700">
                                        {% for file in other_files %}
                                        <tr class="hover:bg-slate-700/50">
                                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-slate-500">
                                                {{ loop.index }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-300">
                                                {{ file }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <a href="{{ url_for('download_file', session_name=session_name, filename=file) }}"
                                                   class="text-indigo-400 hover:text-indigo-300">
                                                   Download
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-12 text-slate-500">
                                <p>No other report files are available for download.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const summaryTable = document.querySelector('.pandas-table table');
            if (summaryTable) {
                // Add numbering header
                const headerRow = summaryTable.querySelector('thead tr');
                if (headerRow) {
                    const newHeader = document.createElement('th');
                    newHeader.textContent = '#';
                    newHeader.scope = 'col';
                    newHeader.className = 'px-6 py-3 text-xs font-medium text-slate-400 uppercase tracking-wider bg-slate-800/95 backdrop-blur-md';
                    headerRow.insertBefore(newHeader, headerRow.firstChild);
                }

                // Add numbering cell to each body row
                const bodyRows = summaryTable.querySelectorAll('tbody tr');
                bodyRows.forEach((row, index) => {
                    const newCell = document.createElement('td');
                    newCell.textContent = index + 1;
                    newCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-slate-500';
                    row.insertBefore(newCell, row.firstChild);
                });
            }
        });

        window.addEventListener('load', function() {
            const loader = document.getElementById('loader-overlay');
            const content = document.getElementById('main-content');
            
            loader.classList.add('opacity-0');
            content.classList.remove('opacity-0');

            // Remove loader from the DOM after transition
            setTimeout(() => {
                loader.style.display = 'none';
            }, 500); // Match transition duration
        });
    </script>
</body>
</html>